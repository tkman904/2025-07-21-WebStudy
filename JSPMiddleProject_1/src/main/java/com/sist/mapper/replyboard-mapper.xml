<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sist.mapper.replyboard-mapper">
  <select id="boardListData" resultType="ReplyBoardVO" parameterType="int">
    <!-- 
    	   group_tab : 간격조절
    	     AAAAA 0
    	       => BBBBB 1
    	         => CCCCC 2
    	   group_id : 답변을 모아둔것
    	     AAAAA 1
    	       => BBBBB 1
    	        => CCCCC 1
    	       => DDDDD 1
    	     EEEEE 2
    	       => KKKKK 2
    	   group_step
    	     AAAAA 0
    	       => BBBBB 1
    	        => CCCCC 2
    	       => DDDDD 3
    	       
    	   AAAAAA          1  0
    	     => BBBBBB     1  1 -> 2
    	       => CCCCCC   1  2 -> 3
    	     => DDDDDD     1  1
     -->
    SELECT no, subject, name, TO_CHAR(regdate, 'YYYY-MM-DD') as dbday, hit, group_tab
    FROM replyboard
    ORDER BY group_id DESC, group_step ASC
    OFFSET #{start} ROWS FETCH NEXT 10 ROWS ONLY
  </select>
  <select id="boardTotalPage" resultType="int">
    SELECT COUNT(*)
    FROM replyboard
  </select>
  
  <!-- 데이터 저장 -->
  <insert id="boardInsert" parameterType="ReplyBoardVO">
    INSERT INTO replyboard(no, name, subject, content, pwd, group_id)
    VALUES(rb_no_seq.nextval, #{name}, #{subject}, #{content}, #{pwd}, 
    	(SELECT NVL(MAX(group_id)+1, 1) FROM replyboard))
  </insert>
  
  <!-- 상세보기 -->
  <update id="boardHitIncrement" parameterType="int">
    UPDATE replyboard SET hit=hit+1
    WHERE no=#{no}
  </update>
  <select id="boardDetailData" resultType="ReplyBoardVO" parameterType="int">
    SELECT no, name, subject, content, hit, TO_CHAR(regdate, 'YYYY-MM-DD HH24:MI:SS') as dbday
    FROM replyboard
    WHERE no=#{no}
  </select>
  
  <!-- 수정하기 -->
  <select id="boardUpdateData" resultType="ReplyBoardVO" parameterType="int">
    SELECT no, name, subject, content
    FROM replyboard
    WHERE no=#{no}
  </select>
  <select id="boardGetPassword" resultType="string" parameterType="int">
    SELECT pwd
    FROM replyboard
    WHERE no=#{no}
  </select>
  <update id="boardUpdate" parameterType="ReplyBoardVO">
    UPDATE replyboard SET
    name=#{name}, subject=#{subject}, content=#{content}
    WHERE no=#{no}
  </update>
  
  <!-- 답변하기 -->
  
  <!-- 삭제하기 -->
</mapper>